## Readme

- 本项目旨在分析、设计、开发实现一些通用框架，以提高自己的设计和编程能力，并不断增强代码质量，学习高质量代码编写，保持阅读源码的习惯。本项目持续更新，目前包含：限流框架、接口幂等框架、灰度发布组件等模块



## 限流框架



### 需求背景

- 对于公共服务平台来说，接口请求来自很多不同的系统（调用方），在系统上线一段时间里，服务平台遇到很多问题。比如，因为调用方代码Bug、不正确地使用服务、业务上面的突发流量，导致来自某个调用方的接口请求数激增，过度争用服务的线程资源，而来自其他调用方的接口请求，因此来不及响应而排队等待，导致接口请求的响应时间大幅增加，甚至出现超时
- 解决方案：开发接口限流功能，限制每个调用方对接口请求的频率。当超过预先设定的访问频率后，我们就触发限流熔断，比如，限制调用方 app-1 对公共服务平台总的接口请求频率不超过 1000 次 / 秒，超过之后的接口请求都会被拒绝。



### 需求分析

- 功能性需求分析：

  - 首先设置限流规则，为了做到不修改代码的前提下修改规则，将规则放置到配置文件中（比如XML、YAML配置文件）。在集成了限流框架的应用启动的时候，限流框架会将限流规则，按照事先定义的语法，解析并加载到内存中。

  - ```yaml
    configs:
    - appId: application-1
      limits:
      - api: /v1/admin
        limit: 100
      - api: /v1/user
        limit: 50
    - appId: application-2
      limits:
      - api: /v1/user
        limit: 50
      - api: /v1/order
        limit: 50
    ```

  - 在接收到接口请求之后，应用会将请求发送给限流框架，限流框架会告诉应用，这个接口请求是允许继续处理，还是触发限流熔断。

- 非功能性需求分析：

  - 易用性，希望限流规则的配置、编程接口的使用都很简单
  - 扩展性、灵活性方面，希望能够灵活地扩展各种限流算法
  - 容错性，接入限流框架是为了提高系统的可用性、稳定性，不能因为限流框架的异常，反过来影响到服务本身的可用性



### 需求设计

- 限流算法：
  - 常见的限流算法有：固定时间窗口限流算法、滑动时间窗口限流算法、令牌桶限流算法、漏桶限流算法
  - 首先使用固定时间窗口限流算法，并预先做好设计，预留好扩展点，方便今后扩展其他限流算法
- 限流模式：
  - 单机限流和分布式限流
- 集成使用：希望框架尽可能低侵入，与业务代码松耦合，替换、删除起来也更容易一些



## 接口幂等框架







## 灰度发布组件